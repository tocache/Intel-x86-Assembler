;Programa realizado por Kalun Lau (25052004)
;Tocache MMS 2004

DATOS SEGMENT
	MARCO1 DB "--------           --------"
	MARCO2 DB "|  --  |           |  --  |" 
	MARCO3 DB "| (  ) |           | (  ) |"
	MARCO4 DB "   ||                 ||   "
	MARCO5 DB "  ----               ----  "
	TITUL  DB "Ingresar el numero de iteraciones (1-9):"
	LUZ    DB "  "
	HACER  DB ?

DATOS ENDS

CODIGO SEGMENT
  ASSUME CS:CODIGO, DS:DATOS

;----------------------------------------------------------------------------------------------------------------------------------
;Construcción de la imagen de los semáforos
INICIO:
	MOV AX, DATOS
	MOV ES, AX		;APUNTA AL SEGMENTO DE DATOS

	CALL MARCO
	CALL TITU


	MOV CH, 00H
	MOV CL, HACER
INICIO2:
	PUSH CX
	CALL ESTADO1
	CALL RETARDO1
	CALL ESTADO2
	CALL RETARDO2
	CALL ESTADO3
	CALL RETARDO1
	CALL ESTADO4
	CALL RETARDO2
	POP CX
	LOOP INICIO2
	JMP FIN	

MARCO:
	LEA BP, MARCO1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 0DH		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 0EH		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO3
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 10H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 11H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO3
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 13H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 14H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO3
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 16H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 17H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO4
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 18H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO4
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 19H		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO4
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 1AH		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO4
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 71H		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 1BH		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, MARCO5
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 7FH		;ATRIBUTO
	MOV CX, 27		;NUMERO DE CARACTERES
	MOV DH, 1CH		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	RET

TITU:
	LEA BP, TITUL
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 1		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 1FH		;ATRIBUTO
	MOV CX, 41		;NUMERO DE CARACTERES
	MOV DH, 1DH		;FILA
	MOV DL, 05H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	PUSH AX
	MOV AH, 01H
	INT 21H
	MOV HACER, AL
	SUB HACER, 30H
	POP AX	
	RET


;----------------------------------------------------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------------------------------------------------
;Inicio de la simulación del semáforo

;PRIMER ESTADO (S1: ROJO, S2: VERDE)

ESTADO1:
	LEA BP, LUZ		;foco rojo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 40H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco rojo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco amarillo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco amarillo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco verde semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco verde semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 20H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	RET


;SEGUNDO ESTADO (S1: ROJO, S2: AMARILLO)

ESTADO2:
	LEA BP, LUZ		;foco rojo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 40H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco rojo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco amarillo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco amarillo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 60H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco verde semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco verde semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	RET

;----------------------------------------------------------------------------------------------------------------------------------

;TERCER ESTADO (S1: VERDE, S2: ROJO)

ESTADO3:
	LEA BP, LUZ		;foco rojo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco rojo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 40H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco amarillo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco amarillo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco verde semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 20H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco verde semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	RET

;----------------------------------------------------------------------------------------------------------------------------------

;CUARTO ESTADO (S1: AMARILLO, S2: ROJO)

ESTADO4:
	LEA BP, LUZ		;foco rojo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco rojo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 40H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 0FH		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco amarillo semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 60H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco amarillo semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 12H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS

	LEA BP, LUZ		;foco verde semáforo 1
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 08H		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	
	LEA BP, LUZ		;foco verde semáforo 2
	MOV AH, 13H		;SERVICIO DE IMPRESION DE CADENA
	MOV AL, 0		;MODO DE ESCRITURA
	MOV BH, 0		;NUMERO DE PAGINA
	MOV BL, 00H		;ATRIBUTO
	MOV CX, 2		;NUMERO DE CARACTERES
	MOV DH, 15H		;FILA
	MOV DL, 1BH		;COLUMNA
	INT 10H			;EJECUCION DE LA INT DE VIDEO DE BIOS
	RET

RETARDO1:
	PUSH DX
	PUSH CX
	PUSH BX
	MOV DX, 1000
P1:	MOV CX, 1000
P2:	MOV BX, 1000
P3:	DEC BX
	JNZ P3
	DEC CX
	JNZ P2
	DEC DX
	JNZ P1
	POP BX
	POP CX
	POP DX
	RET

RETARDO2:
	PUSH DX
	PUSH CX
	PUSH BX
	MOV DX, 1000
P4:	MOV CX, 1000
P5:	MOV BX, 500
P6:	DEC BX
	JNZ P6
	DEC CX
	JNZ P5
	DEC DX
	JNZ P4
	POP BX
	POP CX
	POP DX
	RET

FIN:
	MOV AH, 4CH
	INT 21H

CODIGO ENDS
END INICIO

